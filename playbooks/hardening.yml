---
  - name: Update ubuntu 
    hosts: ubuntu
    become: yes
    tasks:
      - name: System updated
        ansible.builtin.apt:
          name: "*"
          state: latest
          update_cache: true
        notify: Reboot server

      - name: Modify ssh config
        ansible.builtin.lineinfile:
          path: /etc/ssh/sshd_config
          insertafter: '^#PermitRootLogin'
          line: "PermitRootLogin no"
        notify: Reboot ssh
      
      - name: exist directory /opt/test
        ansible.builtin.file:
          path: /opt/test
          state: directory
          owner: nobody
          group: nogroup
          mode: '0777'
        register: result
      
      - name: debug task exist directory
        ansible.builtin.debug:
          msg: "{{ result.diff.after }}"
        when: result.changed
      

    handlers:
        - name: Reboot server
          ansible.builtin.reboot:
        - name: Reboot ssh
          ansible.builtin.systemd_service:
            name: ssh
            state: restarted
            


